<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALABAZTRUM - Perfumes de Navidad</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-white home-page">
    {% include 'partials/navbar.html' %}

    <!-- Área principal con imagen -->
    <main class="w-full home-main bg-white">
        <img 
            src="{{ url_for('static', filename='images/perfumes.png') }}" 
            alt="Perfumes ALABAZTRUM" 
            class="w-full h-auto object-cover block home-image"
        >
        
        <!-- Sección Hero con texto -->
        <section class="py-20 md:py-28 bg-gradient-to-b from-white via-gray-50 to-white">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-4xl mx-auto fade-in">
                    <p class="text-sm md:text-base font-medium text-gray-500 uppercase tracking-wider mb-4 letter-spacing-wide">
                        Bienvenido a
                    </p>
                    <h2 class="text-5xl md:text-7xl font-light text-gray-900 mb-6 leading-tight elegant-title">
                        Descubre tu Fragancia<br class="hidden md:block"> <span class="font-normal">Perfecta</span>
                    </h2>
                    <div class="w-24 h-px bg-gray-300 mx-auto mb-8"></div>
                    <p class="text-base md:text-lg text-gray-500 mb-10 leading-relaxed max-w-2xl mx-auto font-light elegant-text">
                        En ALABAZTRUM encontrarás una selección exclusiva de perfumes y fragancias de las mejores marcas. 
                        Desde clásicos atemporales hasta las últimas novedades, cada fragancia cuenta una historia única.
                    </p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <a href="/fragancias" class="px-10 py-4 bg-gray-900 hover:bg-gray-800 text-white font-light tracking-wide rounded-sm transition-all duration-300 transform hover:scale-105 shadow-md hover:shadow-xl uppercase text-sm letter-spacing-wide">
                            Explorar Fragancias
                        </a>
                        <a href="/decants" class="px-10 py-4 bg-transparent hover:bg-gray-50 text-gray-900 font-light tracking-wide rounded-sm border border-gray-300 hover:border-gray-900 transition-all duration-300 transform hover:scale-105 uppercase text-sm letter-spacing-wide">
                            Ver Decants
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Perfumes Populares -->
        <section class="py-20 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16 fade-in">
                    <h2 class="text-4xl md:text-5xl font-light text-gray-900 mb-4 elegant-title">
                        Más Populares
                    </h2>
                    <p class="text-sm md:text-base text-gray-500 font-light italic max-w-md mx-auto">
                        Las fragancias favoritas de nuestros clientes
                    </p>
                </div>
                <div id="popular-products" class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
                        <p class="text-gray-600 mt-4">Cargando productos populares...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Recomendados -->
        <section class="py-20 bg-gray-50">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16 fade-in">
                    <h2 class="text-4xl md:text-5xl font-light text-gray-900 mb-4 elegant-title">
                        Recomendados
                    </h2>
                    <p class="text-sm md:text-base text-gray-500 font-light italic max-w-md mx-auto">
                        Selección especial de fragancias destacadas
                    </p>
                </div>
                <div id="recommended-products" class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
                        <p class="text-gray-600 mt-4">Cargando recomendaciones...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Marcas Destacadas -->
        <section class="py-20 bg-gray-50">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12 fade-in">
                    <h2 class="text-4xl md:text-5xl font-light text-gray-900 mb-4 elegant-title">
                        Marcas Destacadas
                    </h2>
                    <p class="text-sm md:text-base text-gray-500 font-light italic max-w-md mx-auto">
                        Las mejores marcas de perfumería en un solo lugar
                    </p>
                </div>
                <div id="featured-brands" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6 max-w-6xl mx-auto">
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
                        <p class="text-gray-600 mt-4">Cargando marcas...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Características -->
        <section class="py-20 bg-white border-t border-gray-100">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12 fade-in">
                    <p class="text-xs md:text-sm font-medium text-gray-400 uppercase tracking-widest mb-2 letter-spacing-wide">
                        Nuestro Compromiso
                    </p>
                    <div class="w-16 h-px bg-gray-300 mx-auto"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-12 max-w-5xl mx-auto">
                    <div class="text-center fade-in feature-delay-1">
                        <div class="w-16 h-16 flex items-center justify-center mx-auto mb-6 transform hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-shipping-fast text-3xl text-gray-700"></i>
                        </div>
                        <h3 class="text-lg font-light text-gray-900 mb-3 tracking-wide uppercase text-sm letter-spacing-wide">Envío Rápido</h3>
                        <p class="text-sm text-gray-500 font-light leading-relaxed">Recibe tus fragancias favoritas en tiempo récord</p>
                    </div>
                    <div class="text-center fade-in feature-delay-2">
                        <div class="w-16 h-16 flex items-center justify-center mx-auto mb-6 transform hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-shield-alt text-3xl text-gray-700"></i>
                        </div>
                        <h3 class="text-lg font-light text-gray-900 mb-3 tracking-wide uppercase text-sm letter-spacing-wide">Productos Auténticos</h3>
                        <p class="text-sm text-gray-500 font-light leading-relaxed">Garantizamos la autenticidad de todas nuestras fragancias</p>
                    </div>
                    <div class="text-center fade-in feature-delay-3">
                        <div class="w-16 h-16 flex items-center justify-center mx-auto mb-6 transform hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-headset text-3xl text-gray-700"></i>
                        </div>
                        <h3 class="text-lg font-light text-gray-900 mb-3 tracking-wide uppercase text-sm letter-spacing-wide">Atención Personalizada</h3>
                        <p class="text-sm text-gray-500 font-light leading-relaxed">Nuestro equipo está listo para ayudarte a encontrar tu fragancia ideal</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    {% include 'partials/footer.html' %}

    <!-- Botón flotante de WhatsApp -->
    <a 
        href="https://wa.me/9191936256" 
        target="_blank" 
        rel="noopener"
        class="whatsapp-float"
        aria-label="Contactar por WhatsApp"
    >
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Scripts Firebase y autenticación -->
    <script src="{{ url_for('static', filename='js/firebase-config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navbar-auth.js') }}"></script>
    
    <script>
        // Cargar productos populares y recomendados
        async function loadHomeProducts() {
            try {
                if (typeof db === 'undefined') {
                    setTimeout(loadHomeProducts, 500);
                    return;
                }

                // Cargar todos los productos (solo fragancias, no decants)
                const productsSnapshot = await db.collection('products')
                    .where('isDecant', '==', false)
                    .limit(30)
                    .get();
                
                const products = [];
                productsSnapshot.forEach((doc) => {
                    const product = doc.data();
                    products.push({
                        id: doc.id,
                        ...product
                    });
                });

                // Mostrar productos populares (primeros 8)
                displayProducts(products.slice(0, 8), 'popular-products');
                
                // Mostrar productos recomendados (siguientes 8 o mezclados)
                const recommended = products.length > 8 ? products.slice(8, 16) : products.slice(0, 8);
                displayProducts(recommended, 'recommended-products');
                
                // Cargar marcas destacadas desde la colección de marcas
                loadFeaturedBrands();
                
            } catch (error) {
                console.error('Error cargando productos:', error);
                document.getElementById('popular-products').innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-600">Error al cargar productos. Por favor, intenta más tarde.</p>
                    </div>
                `;
                document.getElementById('recommended-products').innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-600">Error al cargar productos. Por favor, intenta más tarde.</p>
                    </div>
                `;
            }
        }

        function displayProducts(products, containerId) {
            const container = document.getElementById(containerId);
            
            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-600">No hay productos disponibles en este momento.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = products.map((product, index) => {
                const imageUrl = product.images && product.images.length > 0 
                    ? product.images[0] 
                    : 'https://via.placeholder.com/300x300?text=Sin+Imagen';
                
                const price = product.price ? `$${parseFloat(product.price).toFixed(2)}` : 'Precio no disponible';
                const stock = product.stock !== undefined ? parseInt(product.stock) : 0;
                const stockClass = stock === 0 ? 'bg-red-100 text-red-800' : stock < 10 ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                const stockText = stock === 0 ? 'Agotado' : stock < 10 ? `Últimas ${stock}` : 'Disponible';

                return `
                    <div class="product-card fade-in" style="animation-delay: ${index * 0.1}s;">
                        <a href="/producto/${product.id}" class="block group">
                            <div class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                                <div class="relative overflow-hidden" style="padding-top: 100%;">
                                    <img 
                                        src="${imageUrl}" 
                                        alt="${product.name || 'Producto'}"
                                        class="absolute top-0 left-0 w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                                        onerror="this.src='https://via.placeholder.com/300x300?text=Sin+Imagen'"
                                    >
                                    ${stock === 0 ? '<div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded text-xs font-semibold">AGOTADO</div>' : ''}
                                </div>
                                <div class="p-4">
                                    <p class="text-sm text-gray-500 mb-1">${product.brand || 'Sin marca'}</p>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2 group-hover:text-gray-700">
                                        ${product.name || 'Sin nombre'}
                                    </h3>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xl font-bold text-gray-900">${price}</span>
                                        <span class="text-xs px-2 py-1 rounded ${stockClass}">${stockText}</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                `;
            }).join('');
        }

        async function loadFeaturedBrands() {
            const container = document.getElementById('featured-brands');
            if (!container) return;
            
            try {
                if (typeof db === 'undefined') {
                    setTimeout(loadFeaturedBrands, 500);
                    return;
                }
                
                // Cargar marcas desde la colección de marcas
                const brandsSnapshot = await db.collection('brands').orderBy('name').limit(12).get();
                
                if (brandsSnapshot.empty) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <p class="text-gray-600">No hay marcas disponibles en este momento.</p>
                        </div>
                    `;
                    return;
                }
                
                const brands = [];
                brandsSnapshot.forEach((doc) => {
                    const brand = doc.data();
                    brands.push({
                        id: doc.id,
                        name: brand.name,
                        imageUrl: brand.imageUrl || null
                    });
                });
                
                container.innerHTML = brands.map((brand, index) => {
                    const imageDisplay = brand.imageUrl 
                        ? `<div class="w-full h-full rounded-full overflow-hidden flex items-center justify-center bg-white absolute inset-0">
                               <img src="${brand.imageUrl}" alt="${brand.name}" class="max-w-full max-h-full w-auto h-auto object-contain" style="padding: 20%;" onerror="this.style.display='none'; this.parentElement.querySelector('.brand-placeholder').style.display='flex';">
                               <div class="brand-placeholder w-full h-full bg-gray-100 rounded-full flex items-center justify-center absolute inset-0" style="display: none;">
                                   <i class="fas fa-image text-gray-400 text-2xl"></i>
                               </div>
                           </div>`
                        : `<div class="w-full h-full bg-gray-100 rounded-full flex items-center justify-center absolute inset-0">
                               <i class="fas fa-image text-gray-400 text-2xl"></i>
                           </div>`;
                    
                    return `
                        <div class="brand-card fade-in" style="animation-delay: ${index * 0.05}s;">
                            <a href="/fragancias?marca=${encodeURIComponent(brand.name)}" class="block" title="${brand.name}">
                                <div class="bg-white rounded-full shadow-sm hover:shadow-md transition-all duration-300 transform hover:scale-110 border border-gray-100 hover:border-gray-300 relative" style="width: 100%; padding-bottom: 100%;">
                                    ${imageDisplay}
                                </div>
                            </a>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error cargando marcas:', error);
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-600">Error al cargar marcas. Por favor, intenta más tarde.</p>
                    </div>
                `;
            }
        }

        // Cargar productos cuando Firebase esté listo
        if (typeof db !== 'undefined') {
            loadHomeProducts();
        } else {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(() => {
                    if (typeof db !== 'undefined') {
                        loadHomeProducts();
                    }
                }, 1000);
            });
        }
    </script>
</body>
</html>

