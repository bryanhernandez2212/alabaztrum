<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALABAZTRUM - Perfumes de Navidad</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-white home-page">
    {% include 'partials/navbar.html' %}

    <!-- Área principal con imagen -->
    <main class="w-full home-main bg-white">
        <img 
            src="{{ url_for('static', filename='images/perfumes.png') }}" 
            alt="Perfumes ALABAZTRUM" 
            class="w-full h-auto object-cover block home-image"
        >
        
        <!-- Sección Hero con texto -->
        <section class="py-20 md:py-28 bg-gradient-to-b from-white via-gray-50 to-white">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-4xl mx-auto fade-in">
                    <p class="text-sm md:text-base font-medium text-gray-500 uppercase tracking-wider mb-4 letter-spacing-wide">
                        Bienvenido a
                    </p>
                    <h2 class="text-5xl md:text-7xl font-light text-gray-900 mb-6 leading-tight elegant-title">
                        Descubre tu Fragancia<br class="hidden md:block"> <span class="font-normal">Perfecta</span>
                    </h2>
                    <div class="w-24 h-px bg-gray-300 mx-auto mb-8"></div>
                    <p class="text-base md:text-lg text-gray-500 mb-10 leading-relaxed max-w-2xl mx-auto font-light elegant-text">
                        En ALABAZTRUM encontrarás una selección exclusiva de perfumes y fragancias de las mejores marcas. 
                        Desde clásicos atemporales hasta las últimas novedades, cada fragancia cuenta una historia única.
                    </p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <a href="/fragancias" class="px-10 py-4 bg-gray-900 hover:bg-gray-800 text-white font-light tracking-wide rounded-sm transition-all duration-300 transform hover:scale-105 shadow-md hover:shadow-xl uppercase text-sm letter-spacing-wide">
                            Explorar Fragancias
                        </a>
                        <a href="/decants" class="px-10 py-4 bg-transparent hover:bg-gray-50 text-gray-900 font-light tracking-wide rounded-sm border border-gray-300 hover:border-gray-900 transition-all duration-300 transform hover:scale-105 uppercase text-sm letter-spacing-wide">
                            Ver Decants
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Perfumes Populares -->
        <section class="py-20 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16 fade-in">
                    <h2 class="text-4xl md:text-5xl font-light text-gray-900 mb-4 elegant-title">
                        Más Populares
                    </h2>
                    <p class="text-sm md:text-base text-gray-500 font-light italic max-w-md mx-auto">
                        Las fragancias favoritas de nuestros clientes
                    </p>
                </div>
                <div id="popular-products" class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
                        <p class="text-gray-600 mt-4">Cargando productos populares...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Recomendados -->
        <section class="py-20 bg-gray-50">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16 fade-in">
                    <h2 class="text-4xl md:text-5xl font-light text-gray-900 mb-4 elegant-title">
                        Recomendados
                    </h2>
                    <p class="text-sm md:text-base text-gray-500 font-light italic max-w-md mx-auto">
                        Selección especial de fragancias destacadas
                    </p>
                </div>
                <div id="recommended-products" class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
                        <p class="text-gray-600 mt-4">Cargando recomendaciones...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Marcas Destacadas -->
        <section class="py-20 bg-gray-50">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12 fade-in">
                    <h2 class="text-4xl md:text-5xl font-light text-gray-900 mb-4 elegant-title">
                        Marcas Destacadas
                    </h2>
                    <p class="text-sm md:text-base text-gray-500 font-light italic max-w-md mx-auto">
                        Las mejores marcas de perfumería en un solo lugar
                    </p>
                </div>
                <div id="featured-brands" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6 max-w-6xl mx-auto">
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
                        <p class="text-gray-600 mt-4">Cargando marcas...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Características -->
        <section class="py-20 bg-white border-t border-gray-100">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12 fade-in">
                    <p class="text-xs md:text-sm font-medium text-gray-400 uppercase tracking-widest mb-2 letter-spacing-wide">
                        Nuestro Compromiso
                    </p>
                    <div class="w-16 h-px bg-gray-300 mx-auto"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-12 max-w-5xl mx-auto">
                    <div class="text-center fade-in feature-delay-1">
                        <div class="w-16 h-16 flex items-center justify-center mx-auto mb-6 transform hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-shipping-fast text-3xl text-gray-700"></i>
                        </div>
                        <h3 class="text-lg font-light text-gray-900 mb-3 tracking-wide uppercase text-sm letter-spacing-wide">Envío Rápido</h3>
                        <p class="text-sm text-gray-500 font-light leading-relaxed">Recibe tus fragancias favoritas en tiempo récord</p>
                    </div>
                    <div class="text-center fade-in feature-delay-2">
                        <div class="w-16 h-16 flex items-center justify-center mx-auto mb-6 transform hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-shield-alt text-3xl text-gray-700"></i>
                        </div>
                        <h3 class="text-lg font-light text-gray-900 mb-3 tracking-wide uppercase text-sm letter-spacing-wide">Productos Auténticos</h3>
                        <p class="text-sm text-gray-500 font-light leading-relaxed">Garantizamos la autenticidad de todas nuestras fragancias</p>
                    </div>
                    <div class="text-center fade-in feature-delay-3">
                        <div class="w-16 h-16 flex items-center justify-center mx-auto mb-6 transform hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-headset text-3xl text-gray-700"></i>
                        </div>
                        <h3 class="text-lg font-light text-gray-900 mb-3 tracking-wide uppercase text-sm letter-spacing-wide">Atención Personalizada</h3>
                        <p class="text-sm text-gray-500 font-light leading-relaxed">Nuestro equipo está listo para ayudarte a encontrar tu fragancia ideal</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Reseñas -->
        <section class="py-20 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16 fade-in">
                    <h2 class="text-4xl md:text-5xl font-light text-gray-900 mb-4 elegant-title">
                        Lo Que Dicen Nuestros Clientes
                    </h2>
                    <p class="text-sm md:text-base text-gray-500 font-light italic max-w-md mx-auto">
                        Experiencias reales de quienes confían en nosotros
                    </p>
                </div>
                <div id="reviews-container" class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
                        <p class="text-gray-600 mt-4">Cargando reseñas...</p>
                    </div>
                </div>
                <div class="text-center mt-8">
                    <a href="/profile" onclick="event.preventDefault(); if(typeof showTab === 'function') { window.location.href='/profile'; setTimeout(() => showTab('reviews'), 500); } else { window.location.href='/profile'; }" class="inline-block text-gray-600 hover:text-gray-900 transition">
                        <i class="fas fa-star mr-2"></i>
                        Deja tu reseña
                    </a>
                </div>
            </div>
        </section>

    </main>

    {% include 'partials/footer.html' %}

    <!-- Botón flotante de WhatsApp -->
    <a 
        href="https://wa.me/9191936256" 
        target="_blank" 
        rel="noopener"
        class="whatsapp-float"
        aria-label="Contactar por WhatsApp"
    >
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Scripts Firebase y autenticación -->
    <script src="{{ url_for('static', filename='js/firebase-config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    <script src="{{ url_for('static', filename='js/auth-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navbar-auth.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navbar-persistent.js') }}"></script>
    
    <script>
        // Cargar productos populares y recomendados
        async function loadHomeProducts() {
            try {
                let retries = 0;
                while (typeof db === 'undefined' && retries < 10) {
                    await new Promise(r => setTimeout(r, 300));
                    retries++;
                }
                if (typeof db === 'undefined') {
                    throw new Error('Firebase no disponible');
                }

                // Cargar todos los productos (solo fragancias, no decants)
                const productsSnapshot = await db.collection('products')
                    .where('isDecant', '==', false)
                    .limit(30)
                    .get();
                
                const products = [];
                productsSnapshot.forEach((doc) => {
                    const product = doc.data();
                    products.push({
                        id: doc.id,
                        ...product
                    });
                });

                // Mostrar productos populares (primeros 8)
                displayProducts(products.slice(0, 8), 'popular-products');
                
                // Mostrar productos recomendados (siguientes 8 o mezclados)
                const recommended = products.length > 8 ? products.slice(8, 16) : products.slice(0, 8);
                displayProducts(recommended, 'recommended-products');
                
                // Cargar marcas destacadas desde la colección de marcas
                loadFeaturedBrands();
                
                // Cargar reseñas del sitio
                loadSiteReviews();
                
            } catch (error) {
                const unauth = (typeof auth !== 'undefined') ? !isAuthenticated() : true;
                const permErr = error && (error.code === 'permission-denied' || (String(error).toLowerCase().includes('insufficient permissions')));
                if (unauth && permErr) {
                    const loginHtml = `
                        <div class="col-span-full text-center py-12">
                            <p class="text-gray-600 mb-4">Necesitas iniciar sesión para ver productos.</p>
                            <a href="/login" class="inline-block px-4 py-2 bg-gray-900 text-white rounded-md">Iniciar sesión</a>
                        </div>
                    `;
                    const popular = document.getElementById('popular-products');
                    const recommended = document.getElementById('recommended-products');
                    if (popular) popular.innerHTML = loginHtml;
                    if (recommended) recommended.innerHTML = loginHtml;
                } else {
                    const errorHtml = `
                        <div class="col-span-full text-center py-12">
                            <p class="text-gray-600">Error al cargar productos. Por favor, intenta más tarde.</p>
                        </div>
                    `;
                    const popular = document.getElementById('popular-products');
                    const recommended = document.getElementById('recommended-products');
                    if (popular) popular.innerHTML = errorHtml;
                    if (recommended) recommended.innerHTML = errorHtml;
                }
            }
        }

        function displayProducts(products, containerId) {
            const container = document.getElementById(containerId);
            
            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-600">No hay productos disponibles en este momento.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = products.map((product, index) => {
                const imageUrl = product.images && product.images.length > 0 
                    ? product.images[0] 
                    : 'https://via.placeholder.com/300x300?text=Sin+Imagen';
                
                const price = product.price ? `$${parseFloat(product.price).toFixed(2)}` : 'Precio no disponible';
                const stock = product.stock !== undefined ? parseInt(product.stock) : 0;
                const stockClass = stock === 0 ? 'bg-red-100 text-red-800' : stock < 10 ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                const stockText = stock === 0 ? 'Agotado' : stock < 10 ? `Últimas ${stock}` : 'Disponible';

                return `
                    <div class="product-card fade-in" style="animation-delay: ${index * 0.1}s;">
                        <a href="/producto/${product.id}" class="bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100 hover:shadow-lg hover:border-gray-200 transition-all duration-300 transform hover:-translate-y-1 relative flex flex-col h-full block group">
                            <div class="w-full overflow-hidden flex-shrink-0 relative" style="height: 300px; background: linear-gradient(to bottom, #fafafa, #f5f5f5);">
                                <img 
                                    src="${imageUrl}" 
                                    alt="${product.name || 'Producto'}"
                                    class="w-full h-full object-cover object-center group-hover:scale-110 transition-transform duration-500 ease-out"
                                    onerror="this.src='https://via.placeholder.com/300x300?text=Sin+Imagen'"
                                >
                                ${stock === 0 ? '<div class="absolute top-3 right-3 bg-red-500 text-white px-2.5 py-1 rounded-md text-xs font-semibold z-20 shadow-lg">AGOTADO</div>' : ''}
                                <button 
                                    onclick="event.preventDefault(); event.stopPropagation(); toggleFavorite('${product.id}', event);" 
                                    class="absolute top-3 ${stock === 0 ? 'left-3' : 'right-3'} bg-white rounded-full p-2.5 shadow-md hover:shadow-lg hover:bg-gray-50 transition-all z-10 favorite-btn"
                                    data-product-id="${product.id}"
                                    title="Agregar a favoritos"
                                >
                                    <i class="fas fa-heart text-gray-400"></i>
                                </button>
                            </div>
                            <div class="p-5 flex flex-col flex-grow" style="min-height: 150px;">
                                <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2 line-clamp-1">${product.brand || 'Sin marca'}</p>
                                <h3 class="text-base font-semibold text-gray-900 mb-3 line-clamp-2 leading-snug group-hover:text-gray-700 transition-colors flex-1">
                                    ${product.name || 'Sin nombre'}
                                </h3>
                                <div class="flex items-center justify-between mt-auto pt-4 border-t border-gray-100">
                                    <span class="text-xl font-bold text-gray-900">${price}</span>
                                    <span class="text-xs px-2.5 py-1 rounded-full ${stockClass} font-medium">${stockText}</span>
                                </div>
                            </div>
                        </a>
                    </div>
                `;
            }).join('');
            
            // Verificar favoritos después de renderizar
            checkFavorites(products.map(p => p.id));
        }

        // Cargar reseñas del sitio
        async function loadSiteReviews() {
            try {
                if (typeof db === 'undefined') {
                    setTimeout(loadSiteReviews, 500);
                    return;
                }

                const reviewsSnapshot = await db.collection('siteReviews')
                    .where('approved', '==', true)
                    .limit(6)
                    .get();

                const reviewsContainer = document.getElementById('reviews-container');
                
                if (reviewsSnapshot.empty) {
                    reviewsContainer.innerHTML = `
                        <div class="col-span-full text-center py-12 text-gray-500">
                            <i class="fas fa-comments text-3xl mb-3"></i>
                            <p>Aún no hay reseñas publicadas.</p>
                            <p class="text-sm mt-2">Sé el primero en dejar tu opinión.</p>
                        </div>
                    `;
                    return;
                }

                let reviews = [];
                reviewsSnapshot.forEach((doc) => {
                    reviews.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                // Ordenar por fecha más reciente
                reviews.sort((a, b) => {
                    const dateA = a.createdAt?.toDate?.() || new Date(0);
                    const dateB = b.createdAt?.toDate?.() || new Date(0);
                    return dateB - dateA;
                });

                reviewsContainer.innerHTML = reviews.map(review => {
                    const date = review.createdAt?.toDate?.() || new Date();
                    const formattedDate = date.toLocaleDateString('es-ES', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });

                    // Generar estrellas
                    let stars = '';
                    for (let i = 1; i <= 5; i++) {
                        if (i <= review.rating) {
                            stars += '<i class="fas fa-star text-yellow-400"></i>';
                        } else {
                            stars += '<i class="far fa-star text-gray-300"></i>';
                        }
                    }

                    return `
                        <div class="bg-white p-8 rounded-lg shadow-md fade-in">
                            <div class="flex items-center mb-4">
                                <div class="flex text-yellow-400">
                                    ${stars}
                                </div>
                            </div>
                            <h3 class="font-semibold text-gray-900 mb-3">${review.title || 'Reseña'}</h3>
                            <p class="text-gray-600 font-light mb-6 italic leading-relaxed">
                                "${review.review || ''}"
                            </p>
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mr-4">
                                    <i class="fas fa-user text-gray-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900">${review.userName || 'Usuario'}</p>
                                    <p class="text-sm text-gray-500">${formattedDate}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading site reviews:', error);
                document.getElementById('reviews-container').innerHTML = `
                    <div class="col-span-full text-center py-12 text-red-500">
                        <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
                        <p>Error al cargar las reseñas</p>
                    </div>
                `;
            }
        }

        async function loadFeaturedBrands() {
            const container = document.getElementById('featured-brands');
            if (!container) return;
            
            try {
                if (typeof db === 'undefined') {
                    setTimeout(loadFeaturedBrands, 500);
                    return;
                }
                
                // Cargar marcas desde la colección de marcas
                const brandsSnapshot = await db.collection('brands').orderBy('name').limit(12).get();
                
                if (brandsSnapshot.empty) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <p class="text-gray-600">No hay marcas disponibles en este momento.</p>
                        </div>
                    `;
                    return;
                }
                
                const brands = [];
                brandsSnapshot.forEach((doc) => {
                    const brand = doc.data();
                    brands.push({
                        id: doc.id,
                        name: brand.name,
                        imageUrl: brand.imageUrl || null
                    });
                });
                
                container.innerHTML = brands.map((brand, index) => {
                    const imageDisplay = brand.imageUrl 
                        ? `<div class="w-full h-full rounded-full overflow-hidden flex items-center justify-center bg-white absolute inset-0">
                               <img src="${brand.imageUrl}" alt="${brand.name}" class="max-w-full max-h-full w-auto h-auto object-contain" style="padding: 20%;" onerror="this.style.display='none'; this.parentElement.querySelector('.brand-placeholder').style.display='flex';">
                               <div class="brand-placeholder w-full h-full bg-gray-100 rounded-full flex items-center justify-center absolute inset-0" style="display: none;">
                                   <i class="fas fa-image text-gray-400 text-2xl"></i>
                               </div>
                           </div>`
                        : `<div class="w-full h-full bg-gray-100 rounded-full flex items-center justify-center absolute inset-0">
                               <i class="fas fa-image text-gray-400 text-2xl"></i>
                           </div>`;
                    
                    return `
                        <div class="brand-card fade-in" style="animation-delay: ${index * 0.05}s;">
                            <a href="/fragancias?marca=${encodeURIComponent(brand.name)}" class="block" title="${brand.name}">
                                <div class="bg-white rounded-full shadow-sm hover:shadow-md transition-all duration-300 transform hover:scale-110 border border-gray-100 hover:border-gray-300 relative" style="width: 100%; padding-bottom: 100%;">
                                    ${imageDisplay}
                                </div>
                            </a>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error cargando marcas:', error);
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-600">Error al cargar marcas. Por favor, intenta más tarde.</p>
                    </div>
                `;
            }
        }

        // Verificar favoritos y actualizar botones
        async function checkFavorites(productIds) {
            try {
                if (typeof auth === 'undefined' || typeof db === 'undefined' || !auth.currentUser) {
                    return;
                }

                const userId = auth.currentUser.uid;
                const favoriteProductIds = new Set();
                
                // Firestore 'in' acepta máximo 10 valores; dividir en chunks
                const chunkSize = 10;
                for (let i = 0; i < productIds.length; i += chunkSize) {
                    const chunk = productIds.slice(i, i + chunkSize);
                    const snapshot = await db.collection('favorites')
                        .where('userId', '==', userId)
                        .where('productId', 'in', chunk)
                        .get();
                    snapshot.forEach((doc) => {
                        favoriteProductIds.add(doc.data().productId);
                    });
                }

                // Actualizar botones de favoritos
                productIds.forEach((productId) => {
                    const button = document.querySelector(`.favorite-btn[data-product-id="${productId}"]`);
                    if (button) {
                        const icon = button.querySelector('i');
                        if (favoriteProductIds.has(productId)) {
                            icon.classList.remove('text-gray-400');
                            icon.classList.add('text-red-500');
                            button.setAttribute('title', 'Quitar de favoritos');
                        } else {
                            icon.classList.remove('text-red-500');
                            icon.classList.add('text-gray-400');
                            button.setAttribute('title', 'Agregar a favoritos');
                        }
                    }
                });
            } catch (error) {
                console.error('Error verificando favoritos:', error);
            }
        }

        // Toggle favorito
        async function toggleFavorite(productId, event) {
            event.preventDefault();
            event.stopPropagation();

            try {
                if (typeof auth === 'undefined' || typeof db === 'undefined') {
                    alert('Por favor, inicia sesión para agregar productos a favoritos.');
                    return;
                }

                const user = auth.currentUser;
                if (!user) {
                    alert('Por favor, inicia sesión para agregar productos a favoritos.');
                    window.location.href = '/login';
                    return;
                }

                const userId = user.uid;
                const button = event.currentTarget;
                const icon = button.querySelector('i');
                
                // Verificar si ya está en favoritos
                const favoritesSnapshot = await db.collection('favorites')
                    .where('userId', '==', userId)
                    .where('productId', '==', productId)
                    .get();

                if (!favoritesSnapshot.empty) {
                    // Eliminar de favoritos
                    const favoriteDoc = favoritesSnapshot.docs[0];
                    await db.collection('favorites').doc(favoriteDoc.id).delete();
                    
                    icon.classList.remove('text-red-500');
                    icon.classList.add('text-gray-400');
                    button.setAttribute('title', 'Agregar a favoritos');
                } else {
                    // Agregar a favoritos
                    await db.collection('favorites').add({
                        userId: userId,
                        productId: productId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    icon.classList.remove('text-gray-400');
                    icon.classList.add('text-red-500');
                    button.setAttribute('title', 'Quitar de favoritos');
                }
            } catch (error) {
                console.error('Error al manejar favorito:', error);
                alert('Error al actualizar favoritos. Por favor, intenta de nuevo.');
            }
        }

        // Cargar productos cuando Firebase esté listo
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (typeof db !== 'undefined') {
                    loadHomeProducts();
                }
            }, 500);
        });
        if (typeof auth !== 'undefined') {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    loadHomeProducts();
                }
            });
        }
    </script>
</body>
</html>
